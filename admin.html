<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - CozyLoop Studio</title>
<link rel="stylesheet" href="styles.css">

<style>
/* ---------- SAME STYLES (UNCHANGED) ---------- */
.admin-container { max-width:1100px; margin:0 auto; padding:2rem; min-height:100vh; }
.login-form { max-width:420px; margin:120px auto; padding:45px 40px; background:linear-gradient(145deg,#ffffff,#faf7f4); border-radius:22px; box-shadow:0 30px 70px rgba(0,0,0,0.15); text-align:center; }
.login-form h2 { font-size:28px; font-weight:800; margin-bottom:30px; color:#6b5b4a; }
.login-form input { width:100%; padding:14px 18px; border-radius:14px; border:1px solid #ddd; font-size:15px; margin-bottom:25px; }
.login-form button { width:100%; padding:14px; border:none; border-radius:30px; background:linear-gradient(135deg,#ff8fb1,#ff5d8f); color:#fff; font-weight:700; cursor:pointer; }

.admin-panel { display:none; background:#ffffff; padding:40px 30px; border-radius:24px; box-shadow:0 30px 80px rgba(0,0,0,0.12); }
.admin-top { display:flex; justify-content:space-between; align-items:center; gap:20px; margin-bottom:30px; }
.logout-btn { padding:10px 22px; background:#6c757d; color:#fff; border:none; border-radius:30px; font-weight:700; cursor:pointer; }

.admin-tabs { display:flex; gap:15px; margin-bottom:35px; }
.admin-tabs button { padding:10px 22px; border-radius:30px; border:none; cursor:pointer; font-weight:700; }
.admin-tabs .active { background:#6b5b4a; color:#fff; }
.admin-tabs .inactive { background:#e0e0e0; color:#333; }

.section { display:none; }
.section.active { display:block; }

.custom-form { max-width:620px; background:#faf7f4; padding:30px; border-radius:20px; box-shadow:0 15px 40px rgba(0,0,0,0.08); margin-bottom:50px; }
.custom-form input, .custom-form textarea { width:100%; padding:14px 16px; margin-bottom:15px; border-radius:12px; border:1px solid #ddd; font-size:14px; }

.list-box { background:#fff; border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.08); margin-bottom:40px; }

.product-item { display:flex; gap:15px; align-items:center; background:#f8f6f3; padding:15px; border-radius:12px; margin-bottom:12px; }
.product-item img { width:60px; height:60px; object-fit:cover; border-radius:8px; }
.product-item button { background:#dc3545; color:#fff; border:none; padding:6px 12px; border-radius:16px; cursor:pointer; }
</style>
</head>

<body>
<div class="admin-container">

<!-- LOGIN -->
<div class="login-form" id="loginForm"
     style="
        max-width:420px;
        margin:120px auto;
        padding:45px 40px;
        background:linear-gradient(145deg,#ffffff,#faf7f4);
        border-radius:22px;
        box-shadow:0 30px 70px rgba(0,0,0,0.15);
        text-align:center;
        position:relative;
     ">

    <h2 style="
        font-size:28px;
        font-weight:800;
        margin-bottom:30px;
        color:#6b5b4a;
    ">
        Admin Login
    </h2>

    <input type="password" id="passcode" placeholder="Enter Admin Passcode"
           style="
               width:100%;
               padding:14px 18px;
               border-radius:14px;
               border:1px solid #ddd;
               font-size:15px;
               margin-bottom:25px;
           ">

    <button onclick="login()"
            style="
                width:100%;
                padding:14px;
                border:none;
                border-radius:30px;
                background:linear-gradient(135deg,#ff8fb1,#ff5d8f);
                color:#fff;
                font-weight:700;
                cursor:pointer;
                margin-bottom:15px;
            ">
        Login
    </button>

    <!-- Home Button -->
    <a href="index.html"
       style="
            display:inline-block;
            width:100%;
            padding:12px;
            border-radius:30px;
            background:#e0e0e0;
            color:#333;
            font-weight:700;
            text-decoration:none;
            transition:all 0.25s ease;
       "
       onmouseover="this.style.background='#6b5b4a'; this.style.color='#fff'"
       onmouseout="this.style.background='#e0e0e0'; this.style.color='#333'"
    >
        â¬… Back to Home
    </a>

</div>


<!-- ADMIN PANEL -->
<div class="admin-panel" id="adminPanel">

<div class="admin-top">
    <h1>Admin Dashboard</h1>
    <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<div class="admin-tabs">
    <button id="tabProducts" class="active" onclick="switchSection('products')">ðŸ“¦ Manage Products</button>
    <button id="tabRequests" class="inactive" onclick="switchSection('requests')">ðŸ“‹ Custom Requests</button>
</div>

<!-- PRODUCTS -->
<div id="productsSection" class="section active">

<h2>âž• Add New Product</h2>

<form id="productForm" class="custom-form">
    <input type="text" name="name" required placeholder="Product Name">
    <textarea name="description" required placeholder="Product Description"></textarea>
    <input type="text" name="category" required placeholder="Product Category">
    <input type="text" name="price" placeholder="Price (optional)">

    <!-- âœ… FILE UPLOAD -->
    <input type="file" id="imageFile" accept="image/*" required>

    <!-- IMAGE PREVIEW -->
    <img id="imagePreview" style="display:none;width:100%;max-height:200px;object-fit:cover;border-radius:12px;margin-bottom:15px;">

    <button type="submit">Add Product</button>
</form>

<h2>ðŸ“¦ Manage Products</h2>
<div id="productsList" class="list-box"></div>
</div>

<!-- REQUESTS -->
<div id="requestsSection" class="section">
<h2>ðŸ“‹ Custom Requests</h2>
<div id="requestsList" class="list-box"></div>
</div>

</div>
</div>

<script src="db.js"></script>

<script>
const PASSCODE = "cozy123";
let uploadedImageBase64 = "";

/* LOGIN */
function login(){
    if(passcode.value === PASSCODE){
        loginForm.style.display="none";
        adminPanel.style.display="block";
        loadProducts(); loadRequests();
    } else alert("Wrong passcode");
}
function logout(){
    loginForm.style.display="block";
    adminPanel.style.display="none";
}

/* TAB SWITCH */
function switchSection(type){
    productsSection.classList.toggle("active", type==="products");
    requestsSection.classList.toggle("active", type==="requests");
    tabProducts.className = type==="products"?"active":"inactive";
    tabRequests.className = type==="requests"?"active":"inactive";
}

/* IMAGE UPLOAD */
imageFile.addEventListener("change", ()=>{
    const file = imageFile.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        uploadedImageBase64 = e.target.result;
        imagePreview.src = uploadedImageBase64;
        imagePreview.style.display="block";
    };
    reader.readAsDataURL(file);
});

/* ADD PRODUCT */
productForm.addEventListener("submit", async e=>{
    e.preventDefault();
    const fd = new FormData(productForm);
    await db.saveProduct({
        name:fd.get("name"),
        description:fd.get("description"),
        category:fd.get("category"),
        price:fd.get("price"),
        imageBase64: uploadedImageBase64,
        timestamp:new Date().toISOString()
    });
    productForm.reset();
    imagePreview.style.display="none";
    uploadedImageBase64="";
    loadProducts();
});

/* LOAD PRODUCTS */
async function loadProducts(){
    const products = await db.getProducts();
    productsList.innerHTML = products.map(p=>`
        <div class="product-item">
            <img src="${p.imageBase64}">
            <div>
                <strong>${p.name}</strong><br>
                â‚¹${p.price || "-"}
            </div>
            <button onclick="deleteProduct(${p.id})">Delete</button>
        </div>
    `).join("") || "No products yet";
}

async function deleteProduct(id){
    if(confirm("Delete product?")){
        await db.deleteProduct(id);
        loadProducts();
    }
}

/* REQUESTS */
async function loadRequests() {
    const r = await db.getCustomRequests();

    if (!r.length) {
        requestsList.innerHTML = "No requests yet";
        return;
    }

    requestsList.innerHTML = r.map(x => {
        const imageSrc =
            x.imageBase64 ||
            x.imageUrl ||
            x.refImage ||
            "";

        return `
            <div class="product-item" style="align-items:flex-start; gap:15px;">

                ${imageSrc ? `
                    <img 
                        src="${imageSrc}" 
                        alt="Customer reference"
                        style="
                            width:70px;
                            height:70px;
                            object-fit:cover;
                            border-radius:10px;
                            cursor:pointer;
                            border:1px solid #ddd;
                        "
                        onclick="window.open('${imageSrc}', '_blank')"
                    >
                ` : ""}

                <div style="flex:1;">
                    <strong>${x.productType}</strong><br>
                    <span style="color:#555;">${x.notes || "No notes provided"}</span>
                </div>

                <button 
                    onclick="deleteRequest(${x.id})"
                    style="
                        background:#dc3545;
                        color:#fff;
                        border:none;
                        padding:6px 12px;
                        border-radius:16px;
                        cursor:pointer;
                        height:fit-content;
                    "
                >
                    Delete
                </button>

            </div>
        `;
    }).join("");
}


async function deleteRequest(id){
    if(confirm("Delete request?")){
        await db.deleteRequest(id);
        loadRequests();
    }
}
</script>
</body>
</html>
